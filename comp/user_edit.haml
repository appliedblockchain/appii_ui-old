%user-edit
  %h4 Edit your profile:
  %h2 { user.name }
  %form{ onsubmit: "{ update }" }
    %h4
      %input.big-text{placeholder: "Your current Job Title", name: "jobTitle", type: "text", value: "{ user.jobTitle }"}/
    .row
      .column.overlay_cont
        %label.normal
          %img.avatar{ src: "{ user.avatarLg }" }
          .icon.overlay.white ðŸ“·
          %input{ type: "file" }
      .column.column-80
        %p.border{ contentEditable: true }
          Bio: Lorem ipsum dolor sit amet, consectetur adipiscing elit. In consequat mauris et ante pretium ultricies. Curabitur eget ante eu enim efficitur congue. Praesent non condimentum turpis. In ultricies ipsum in sapien rutrum, eu ultricies mauris interdum.
          { user.bio }
        .row
          .column.column-20
            %label
              %strong Location:
          .column.column-80
            %input{placeholder: "Your City, Planet Earth", name: "location", type: "text", value: "{ user.location }"}/
        .row
          .column.column-20
            %label
              %strong Nationality:
          .column.column-80
            %input{placeholder: "Your country of Origin", name: "nationality", type: "text", value: "{ user.nationality }"}/

    %fieldset
      %label
        Email
        %input{placeholder: "you@email.com", name: "email", type: "email"}/
      %label
        Gender
        %input{placeholder: "M / F", name: "gender", type: "text", value: "{ user.gender }"}
      %label
        Cover letter
        %textarea{placeholder: "A generic cover letter you want to send to your ideal employer, why you are suited for the job."}

      %input.left.button-primary{onclick: "{ update }", type: "submit", value: "Save"}/

      .spinner
        .rect1
        .rect2
        .rect3
        .rect4
        .rect5

      .message { message }


  %style{scoped: true}
    :plain
      :scope *[contentEditable]  {
        display: block;
        margin-bottom: 12px;
      }
      :scope label {
        margin-top: 10px;
      }
      :scope input[type=file] {
        display: none;
      }


  :coffeescript
    -# user_id = 2
    entry_id = 2

    BR.loadFromCollection "user", entry_id, "users", this


    @message = ""

    @.on 'mount', (data) =>
      spinner = $ ".spinner"

      $("input[type=submit]").on "click", (evt) =>
        spinner.css
          visibility: "visible"

        values = $("profile form").serializeArray()
        newValues = {}
        _(values).each (entry) ->
          newValues[entry.name] = entry.value

        _(newValues).each (value, key) =>
          @user[key] = value if @user.hasAttribute key

        # TODO: fix this - avatar and avatarLg must be stored in the blockchain
        userValues = {}
        _(@user).each (value, key) =>
          userValues[key] = value if @user.hasAttribute key

        c.log "Updating user:", @user
        User.update(userValues)
          .then (resp) =>
            c.log "User updated:", resp
            spinner.css
              visibility: "hidden"
            $(".message").html "saved!"
          .catch (error) ->
            c.log "Error updating current User:", error
